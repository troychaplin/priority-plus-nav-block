(()=>{class t{constructor(t){if(this.wrapper=t,this.nav=t.querySelector(".wp-block-navigation"),!this.nav)return;this.list=this.nav.querySelector(".wp-block-navigation__container"),this.moreLabel=t.getAttribute("data-more-label")||"More",this.moreIcon=t.getAttribute("data-more-icon")||"dots";let e=null;if(this.nav.attributes)for(let t=0;t<this.nav.attributes.length;t++){const i=this.nav.attributes[t],o=i.name.toLowerCase();if(o.includes("open")&&o.includes("submenu")&&o.includes("click")){e=i.value;break}if("data-opensubmenusonclick"===o||"data-open-submenus-on-click"===o){e=i.value;break}}if(null===e&&(this.nav.classList.contains("open-on-click")||this.nav.classList.contains("open-submenus-on-click")||this.nav.classList.contains("has-open-submenus-on-click"))&&(e="true"),null===e&&this.list){const t=this.list.querySelector("li.has-child, li.open-on-click");t&&(t.classList.contains("open-on-click")||t.classList.contains("open-submenus-on-click"))&&(e="true")}if(this.openSubmenusOnClick="true"===e||"1"===e||""===e,"undefined"!=typeof console&&console.log){const t={};if(this.nav.attributes)for(let e=0;e<this.nav.attributes.length;e++){const i=this.nav.attributes[e];t[i.name]=i.value}console.log("Priority Nav - All nav attributes:",t),console.log("Priority Nav - openSubmenusOnClick:",this.openSubmenusOnClick,"from attr:",e),console.log("Priority Nav - Nav classes:",Array.from(this.nav.classList))}this.list&&(this.createMoreButton(),this.items=Array.from(this.list.children),this.itemWidths=[],this.isOpen=!1,this.isCalculating=!1,this.openAccordions=[],this.submenuCounter=0,this.init())}createMoreButton(){this.moreContainer=document.createElement("div"),this.moreContainer.className="priority-nav-more",this.moreButton=document.createElement("button"),this.moreButton.type="button",this.moreButton.className="priority-nav-more-button wp-block-navigation-item",this.moreButton.setAttribute("aria-expanded","false"),this.moreButton.setAttribute("aria-haspopup","true"),this.moreButton.setAttribute("aria-label",this.moreLabel);const t={dots:"•••",chevron:"▼",plus:"+",menu:"≡"};this.moreButton.innerHTML=`\n\t\t\t<span class="wp-block-navigation-item__label">${this.moreLabel}</span>\n\t\t\t<span class="priority-nav-icon">${t[this.moreIcon]||t.dots}</span>\n\t\t`,this.dropdown=document.createElement("ul"),this.dropdown.className="priority-nav-dropdown wp-block-navigation__submenu-container",this.dropdown.setAttribute("role","menu"),this.moreContainer.appendChild(this.moreButton),this.moreContainer.appendChild(this.dropdown),this.list.parentNode.appendChild(this.moreContainer),this.moreContainer.style.display="none"}init(){this.cacheItemWidths(),this.setupEventListeners(),requestAnimationFrame(()=>{this.checkOverflow()}),new ResizeObserver(()=>{this.isCalculating||requestAnimationFrame(()=>this.checkOverflow())}).observe(this.wrapper)}cacheItemWidths(){this.items.forEach(t=>{t.style.display=""}),this.itemWidths=this.items.map(t=>t.getBoundingClientRect().width)}setupEventListeners(){this.moreButton.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.toggleDropdown()}),document.addEventListener("click",t=>{!this.moreContainer.contains(t.target)&&this.isOpen&&this.closeDropdown()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isOpen&&(this.openAccordions.length>0?(this.closeAllAccordions(),t.preventDefault()):this.closeDropdown())}),this.dropdown.addEventListener("click",t=>{const e=t.target.closest(".priority-nav-accordion-toggle");if(e){t.preventDefault(),t.stopPropagation();const i=e.getAttribute("aria-controls"),o=document.getElementById(i);o&&this.toggleAccordionItem(e,o)}})}checkOverflow(){this.isCalculating=!0;const t=this.wrapper.getBoundingClientRect().width,e=window.getComputedStyle(this.nav),i=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),o=parseFloat(e.gap)||8;this.moreContainer.style.display="";const n=this.moreButton.getBoundingClientRect().width;let s=t-i,r=0,a=0;for(let t=0;t<this.items.length;t++)a+=(t>0?o:0)+this.itemWidths[t];if(a<=s)return this.items.forEach(t=>t.style.display=""),this.moreContainer.style.display="none",this.closeDropdown(),void(this.isCalculating=!1);let l=0;for(let t=0;t<this.items.length;t++){const e=(t>0?o:0)+this.itemWidths[t];if(!(l+e+o+n<=s)&&0!==t)break;this.items[t].style.display="",l+=e,r++}this.dropdown.innerHTML="",this.submenuCounter=0;let c=!1;for(let t=r;t<this.items.length;t++){this.items[t].style.display="none";const e=this.extractNavItemData(this.items[t]),i=this.buildAccordionHTML(e,0),o=document.createElement("li");o.innerHTML=i,"undefined"!=typeof console&&console.log&&(console.log("Built accordion HTML:",i),console.log("Item data:",e)),this.dropdown.appendChild(o),c=!0}c?this.moreContainer.style.display="":(this.moreContainer.style.display="none",this.closeDropdown()),this.isCalculating=!1}toggleDropdown(){this.isOpen?this.closeDropdown():this.openDropdown()}openDropdown(){this.isOpen=!0,this.dropdown.classList.add("is-open"),this.moreButton.setAttribute("aria-expanded","true")}closeDropdown(){this.isOpen=!1,this.dropdown.classList.remove("is-open"),this.moreButton.setAttribute("aria-expanded","false"),this.closeAllAccordions()}extractNavItemData(t){const e={text:"",url:"#",hasSubmenu:!1,children:[]},i=t.querySelector(":scope > .wp-block-navigation__submenu-container");let o=t.querySelector(":scope > a");if(o||(o=t.querySelector(":scope > .wp-block-navigation-item__content a")),!o){if(i){const i=t.cloneNode(!0),o=i.querySelector(".wp-block-navigation__submenu-container");o&&o.remove(),e.text=i.textContent.trim()}else e.text=t.textContent.trim();return i&&(e.hasSubmenu=!0,i.querySelectorAll(":scope > li").forEach(t=>{e.children.push(this.extractNavItemData(t))})),e}const n=o.querySelector(".wp-block-navigation-item__label");if(n)e.text=n.textContent.trim();else{const t=o.cloneNode(!0);if(t.querySelectorAll("*").forEach(t=>t.remove()),e.text=t.textContent.trim(),!e.text){const t=Array.from(o.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE);t.length>0&&(e.text=t.map(t=>t.textContent.trim()).filter(t=>t).join(" "))}}if(i&&e.text){const t=[];i.querySelectorAll("li a").forEach(i=>{const o=i.textContent.trim();o&&e.text.includes(o)&&t.push(o)}),t.length>0&&t.forEach(t=>{e.text=e.text.replace(t,"").trim()})}return e.url=o.getAttribute("href")||"#",i&&(e.hasSubmenu=!0,i.querySelectorAll(":scope > li").forEach(t=>{e.children.push(this.extractNavItemData(t))})),e}buildAccordionHTML(t,e){const i="priority-nav-submenu-"+this.submenuCounter++;let o="";return t.hasSubmenu?(o=this.openSubmenusOnClick?`\n\t\t\t\t\t<button type="button" class="priority-nav-accordion-toggle priority-nav-accordion-toggle-full" \n\t\t\t\t\t        aria-expanded="false" aria-controls="${i}">\n\t\t\t\t\t\t<span class="priority-nav-accordion-text">${this.escapeHtml(t.text)}</span>\n\t\t\t\t\t\t<span class="priority-nav-accordion-arrow" aria-hidden="true">›</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<ul class="priority-nav-accordion-content" id="${i}" aria-hidden="true">\n\t\t\t\t`:`\n\t\t\t\t\t<span class="priority-nav-accordion-wrapper">\n\t\t\t\t\t\t<a href="${this.escapeHtml(t.url)}" class="priority-nav-accordion-link">${this.escapeHtml(t.text)}</a>\n\t\t\t\t\t\t<button type="button" class="priority-nav-accordion-toggle priority-nav-accordion-toggle-arrow" \n\t\t\t\t\t\t        aria-expanded="false" aria-controls="${i}" aria-label="Toggle submenu">\n\t\t\t\t\t\t\t<span class="priority-nav-accordion-arrow" aria-hidden="true">›</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>\n\t\t\t\t\t<ul class="priority-nav-accordion-content" id="${i}" aria-hidden="true">\n\t\t\t\t`,t.children.forEach(t=>{o+=`<li>${this.buildAccordionHTML(t,e+1)}</li>`}),o+="</ul>"):o=`<a href="${this.escapeHtml(t.url)}">${this.escapeHtml(t.text)}</a>`,o}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}toggleAccordionItem(t,e){const i="true"===t.getAttribute("aria-expanded");"undefined"!=typeof console&&console.log&&console.log("toggleAccordionItem called, isExpanded:",i,"submenu ID:",e.id),i?(t.setAttribute("aria-expanded","false"),e.style.setProperty("display","none","important"),e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"),this.openAccordions=this.openAccordions.filter(e=>e.button!==t),e.querySelectorAll('.priority-nav-accordion-toggle[aria-expanded="true"]').forEach(t=>{const e=t.getAttribute("aria-controls"),i=document.getElementById(e);i&&(t.setAttribute("aria-expanded","false"),i.style.setProperty("display","none","important"),i.classList.remove("is-open"),i.setAttribute("aria-hidden","true"))}),"undefined"!=typeof console&&console.log&&console.log("Accordion closed")):(t.setAttribute("aria-expanded","true"),e.style.setProperty("display","block","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("position","static","important"),e.classList.add("is-open"),e.setAttribute("aria-hidden","false"),"undefined"!=typeof console&&console.log&&console.log("Accordion opened, submenu styles:",{display:window.getComputedStyle(e).display,opacity:window.getComputedStyle(e).opacity,visibility:window.getComputedStyle(e).visibility}),this.openAccordions.push({button:t,submenu:e}))}closeAllAccordions(){this.openAccordions.forEach(({button:t,submenu:e})=>{t.setAttribute("aria-expanded","false"),e.style.setProperty("display","none","important"),e.classList.remove("is-open"),e.setAttribute("aria-hidden","true")}),this.openAccordions=[]}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-priority-nav]").forEach(e=>new t(e))})})();